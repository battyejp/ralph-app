## Codebase Patterns
- Project uses .NET 10 and MySQL with Pomelo.EntityFrameworkCore.MySql
- Entity configuration is done using Fluent API in ApplicationDbContext.OnModelCreating
- Test coverage is calculated per-class - focus on relevant code coverage not global coverage
- EF Core migrations are in CustomerApi/Migrations/ directory
- Docker Compose is used for MySQL database (port 3306)
- Connection string uses format: Server=localhost;Port=3306;Database=customerdb;User=root;Password=password;
- Environment variables are stored in .env file (not committed) with .env.example as template

# Ralph Progress Log
Started: 01/15/2026 11:20:59
---

## 01/15/2026 11:32 - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented Customer entity with all required fields (Id, Name, Email, Phone, Address, CreatedAt, UpdatedAt)
- Configured entity with Fluent API for constraints:
  - Name: required, max 100 chars
  - Email: required, max 255 chars, unique index
  - Phone: optional, max 20 chars
  - Address: optional, max 500 chars
- Created and applied initial EF Core migration to MySQL database
- Updated projects to target .NET 10 (from .NET 9)
- Replaced SQL Server provider with Pomelo.EntityFrameworkCore.MySql
- Recreated docker-compose.yml and .env.example files

Files changed:
- CustomerApi/Models/Customer.cs (already existed with correct fields)
- CustomerApi/Data/ApplicationDbContext.cs (added max length for Email)
- CustomerApi/CustomerApi.csproj (updated to .NET 10, changed to MySQL provider)
- CustomerApi/Program.cs (changed from UseSqlServer to UseMySql)
- CustomerApi/appsettings.json (updated connection string for MySQL)
- CustomerApi/Migrations/20260115112934_InitialCreate.cs (new migration)
- CustomerApi.Tests/CustomerApi.Tests.csproj (updated to .NET 10)
- docker-compose.yml (recreated)
- .env.example (recreated)

**Learnings for future iterations:**
- The project previously had SQL Server migrations that needed to be removed before creating MySQL migrations
- When switching database providers, old migrations cause build errors and must be deleted
- .NET 10 requires dotnet-ef version 10.0.0 - version mismatches cause errors
- Customer model and ApplicationDbContext both have 100% test coverage
- Overall coverage appears low (39%) but includes untested boilerplate like Program.cs and WeatherForecast.cs
- For story acceptance, focus on coverage of the specific code being implemented, not global coverage
- The branch name in PRD must match exactly (ralph/customer-api not ralph/claude-customer-api)
---

## 01/15/2026 14:09 - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented POST /api/customers endpoint in CustomersController
- Endpoint accepts CreateCustomerDto and returns 201 Created with CustomerResponseDto
- Returns 400 Bad Request for invalid model state with validation details
- Location header is set in response pointing to CreateCustomer action
- CreatedAt and UpdatedAt timestamps automatically set to UTC time
- Generated new GUID for customer Id on creation
- Registered ICustomerRepository as scoped service in DI container
- Comprehensive unit tests created with 100% controller coverage
- All 89 tests passing (10 new controller tests added)

Files changed:
- CustomerApi/Program.cs (registered ICustomerRepository in DI container)
- CustomerApi/Controllers/CustomersController.cs (new controller with POST endpoint)
- CustomerApi.Tests/Controllers/CustomersControllerTests.cs (new test file with 10 comprehensive tests)

**Learnings for future iterations:**
- Controller uses constructor injection for ICustomerRepository and IMapper
- AutoMapper was already configured in Program.cs from US-003
- Controller tests use Moq for repository mocking and actual AutoMapper configuration for mapping
- The CreateCustomerDto already has DataAnnotations validation ([Required], [EmailAddress], [StringLength]) from US-003
- ModelState validation happens automatically in ASP.NET Core before controller action execution
- CreatedAtAction returns 201 with Location header - route values include the created resource id
- Tests verify proper UTC timestamp setting using BeCloseTo for time comparison (within 5 seconds)
- FluentAssertions provides clean test assertions (Should().BeOfType, Should().NotBeNull, etc.)
- Coverage report shows per-class coverage - CustomersController achieved 100% coverage
---
